--Este solo devuelve las medidas de ese usuario en esa fecha.
CREATE OR REPLACE FUNCTION fo_m04_get_progresoM(usuario_CI int, fecha DATE)
  RETURNS TABLE(medida INT, tipo character varying)
   AS $$
DECLARE
   var_r    record;
BEGIN
   FOR var_r IN(SELECT pm_medida, med_tipo
        FROM usuario inner join  progreso_medida on usu_id = fk_usuario inner join medida on fk_medida = med_id
        WHERE usu_cedula = usuario_CI AND pm_fecha = fecha)
   LOOP
    medida = var_r.pm_medida
    tipo = var_r.med_tipo
    RETURN NEXT;
   END LOOP;
END; $$
  LANGUAGE plpgsql;


--Este elimina las medidas correspondientes a esa fecha y a ese usuario
CREATE OR REPLACE FUNTION fo_m04_elimina_medidas (usuario_CI int, fecha DATE)
	RETURNS void AS $$
    DECLARE
    BEGIN
        DELETE FROM progreso_medida
        WHERE pm_fecha = fecha and pk_usuario = usuario_CI;
    END; $$
LANGUAGE plpgsql;

-- INSERTA MEDIDAS PERTENECIENTE A ESE USUARIO EN LA FECHA ACTUAL
CREATE OR REPLACE fo_m04_inserta_medidas(
    fk_usuario INT,
    medida INT,
    tipo VARCHAR,
    fecha DATE)
  RETURNS void
   AS $$
    DECLARE
	fecha_actual DATE;
    BEGIN
	fecha_actual  := current_date;
        INSERT INTO progreso_medida (pm_medida,pm_fecha, fk_usuario, fk_medida) VALUES
        ( medida , fecha_actual , fk_usuario , medida );
    END; $$
  LANGUAGE plpgsql;



