CREATE USER GYMUCAB PASSWORD 'GYMUCAB';
ALTER ROLE GYMUCAB WITH SUPERUSER;
CREATE DATABASE GIMNASIOBD WITH OWNER GYMUCAB;
 
CREATE TABLE USUARIO(
USU_ID                  	SERIAL ,
USU_CEDULA                  	INTEGER NOT NULL,
USU_NOMBRE                	VARCHAR(10) NOT NULL,
USU_APELLIDO               	VARCHAR(10) NOT NULL,
USU_SEXO           	CHAR NOT NULL,
USU_FECHA_NAC          	DATE NOT NULL,
CONSTRAINT PK_USU_ID PRIMARY KEY (USU_ID)
);

-- TABLAS FOM05
 
-- M05
CREATE TABLE INSTRUCTOR
(
 INS_ID                  	SERIAL NOT NULL,
 INS_NOMBRE                 	CHARACTER VARYING(10) NOT NULL,
 INS_APELLIDO                	CHARACTER VARYING(10) NOT NULL,
 INS_FECHA_NAC   DATE NOT NULL,
 INS_SEXO            	CHARACTER(1) NOT NULL,
 INS_CORREO                 	CHARACTER VARYING(20) NOT NULL,
 INS_FOTO            	BYTEA,
 CONSTRAINT INSTRUCTOR_PKEY PRIMARY KEY (INS_ID)
);
 
CREATE TABLE CLASE
(
 CLA_ID                 	SERIAL NOT NULL,
 CLA_NOMBRE                	CHARACTER VARYING(10) NOT NULL,
 CLA_DESCRIPCION       	CHARACTER VARYING(300) NOT NULL,
 CONSTRAINT CLASE_PKEY PRIMARY KEY (CLA_ID)
);
 
CREATE TABLE HORARIO_CLASE(
HC_ID                           SERIAL NOT NULL,
HC_FECHA           		DATE NOT NULL,
HC_CAPACIDAD              	INTEGER  NOT NULL,
HC_HORA_INICIO   		TIME NOT NULL,
HC_HORA_FIN                 	TIME NOT NULL,
HC_DURACION               	TIME,
FK_USUARIO                   	INTEGER,
FK_INSTRUCTOR           	INTEGER ,
FK_CLASE            		INTEGER ,
CONSTRAINT FK_USUARIO  FOREIGN KEY(FK_USUARIO) REFERENCES USUARIO(USU_ID) ON DELETE CASCADE ON UPDATE CASCADE,
CONSTRAINT PK_INSTRUCTOR  FOREIGN KEY(FK_INSTRUCTOR) REFERENCES INSTRUCTOR(INS_ID) ON DELETE CASCADE ON UPDATE CASCADE,
CONSTRAINT PK_CLASE_USUARIO  FOREIGN KEY(FK_CLASE) REFERENCES CLASE(CLA_ID) ON DELETE CASCADE ON UPDATE CASCADE,
CONSTRAINT PK_HC_ID PRIMARY KEY (HC_ID)
);

CREATE TABLE CRITICA(
CRI_ID			SERIAL NOT NULL,
CRI_FECHA		DATE NOT NULL,
CRI_COMENTARIO		CHARACTER VARYING(400),
CRI_VALORACION		INTEGER,
FK_HC_ID		INTEGER,
CONSTRAINT FK_HC_ID FOREIGN KEY (FK_HC_ID) REFERENCES HORARIO_CLASE(HC_ID) ON DELETE CASCADE ON UPDATE CASCADE,
CONSTRAINT PK_CRI_ID PRIMARY KEY (CRI_ID)
);

-- FIN TABLAS FOM05

-- TABLAS DE FO_M04

CREATE TABLE MEDIDA(
	med_id		serial  not null,
	med_tipo	varchar(20) unique not null,
CONSTRAINT pk_med_id PRIMARY KEY (med_id)

);

CREATE TABLE PROGRESO_MEDIDA(
	pm_id		serial not null,
	pm_medida	integer,
	pm_fecha	date not null,
	fk_usuario	integer,
	fk_medida	integer,
CONSTRAINT pk_pm_id PRIMARY KEY (pm_id),
CONSTRAINT fk_usuario  FOREIGN KEY(fk_usuario) REFERENCES usuario(usu_id) ON DELETE CASCADE ON UPDATE CASCADE,
CONSTRAINT fk_medida  FOREIGN KEY(fk_medida) REFERENCES medida(med_id) ON DELETE CASCADE ON UPDATE CASCADE	

);

CREATE TABLE PROGRESO_PESO(
	pp_id		serial not null,
	pp_peso		integer,	
	pp_fecha	date not null,
	fk_usuario	integer not null,
CONSTRAINT pk_pp_id PRIMARY KEY (pp_id),
CONSTRAINT fk_usuario  FOREIGN KEY(fk_usuario) REFERENCES usuario(usu_id) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE COMENTARIO(
	com_id		serial not null,
	com_mensaje	varchar(80),
	fk_usuario	integer not null,
	fk_pro_peso	integer,
	fk_pro_medida	integer,
CONSTRAINT pk_com_id PRIMARY KEY (com_id),
CONSTRAINT fk_usuario  FOREIGN KEY(fk_usuario) REFERENCES usuario(usu_id) ON DELETE CASCADE ON UPDATE CASCADE,
CONSTRAINT fk_pro_peso  FOREIGN KEY(fk_pro_peso) REFERENCES progreso_peso(pp_id) ON DELETE CASCADE ON UPDATE CASCADE,
CONSTRAINT fk_pro_medida FOREIGN KEY(fk_pro_medida) REFERENCES progreso_medida(pm_id) ON DELETE CASCADE ON UPDATE CASCADE
);

-- FIN DE F0_M04

-- TABLAS DE FO_M06

CREATE TABLE ENTRENADOR (
	ENT_ID serial not null,
	ENT_nombre character varying (50) not null,
	ENT_fecha_nac date not null,
	ENT_sexo char not null,
	ENT_correo character varying (100) not null,
	ENT_historial character varying (200) not null,
	ENT_foto bytea,
	CONSTRAINT PK_ENT_ID PRIMARY KEY (ENT_ID)	
);


CREATE TABLE USUARIO_ENTRENADOR(
	FK_USUARIO		INTEGER NOT NULL,
	FK_ENTRENADOR	INTEGER NOT NULL,
CONSTRAINT PK_UE_ID PRIMARY KEY (FK_USUARIO, FK_ENTRENADOR),
CONSTRAINT FK_USUARIO  FOREIGN KEY(FK_USUARIO) REFERENCES USUARIO(USU_ID) ON DELETE CASCADE ON UPDATE CASCADE,
CONSTRAINT FK_ENTRENADOR  FOREIGN KEY(FK_ENTRENADOR) REFERENCES ENTRENADOR(ENT_ID) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE RESERVA(
	RES_ID					SERIAL NOT NULL,
	RES_FECHA_INI			DATE NOT NULL,	
	RES_FECHA_FIN			DATE NOT NULL,
	FK_USUARIO				INTEGER NOT NULL,
	FK_ENTRENADOR			INTEGER NOT NULL,
CONSTRAINT PK_RES_ID PRIMARY KEY (RES_ID),
CONSTRAINT FK_USUARIO  FOREIGN KEY(FK_USUARIO,FK_ENTRENADOR) REFERENCES USUARIO_ENTRENADOR(FK_USUARIO,FK_ENTRENADOR) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE MENSAJE(
	MES_ID					SERIAL NOT NULL,
	MES_MENSAJE				VARCHAR(250) NOT NULL,	
	FK_USUARIO				INTEGER NOT NULL,
	FK_ENTRENADOR			INTEGER NOT NULL,
CONSTRAINT PK_MES_ID PRIMARY KEY (MES_ID),
CONSTRAINT FK_USUARIO  FOREIGN KEY(FK_USUARIO,FK_ENTRENADOR) REFERENCES USUARIO_ENTRENADOR(FK_USUARIO,FK_ENTRENADOR) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE PROGRESO_RUTINA(
	PR_ID		SERIAL NOT NULL,
	PR_PROGRESO		VARCHAR(50) NOT NULL,	
	PR_EVALUACION		VARCHAR(50) NOT NULL,
	FK_RUTINA	INTEGER NOT NULL,
CONSTRAINT PK_PR_ID PRIMARY KEY (PR_ID),
CONSTRAINT FK_RUTINA  FOREIGN KEY(FK_RUTINA) REFERENCES RUTINA(RUT_ID) ON DELETE CASCADE ON UPDATE CASCADE
);



-- FIN TABLAS DE FO_M06



